# 窗口改造说明

## 概述

本次修改将原来的对话框（Dialog）改造为独立的窗口（ApplicationWindow），实现了以下目标：

1. **用户详情窗口** - 将 `UserDetailDialog` 改造为 `UserDetailWindow`
2. **添加好友窗口** - 将 `AddFriendConfirmDialog` 改造为 `AddFriendWindow`
3. **窗口独立性** - 确保窗口之间互不影响，可以独立操作

## 修改内容

### 1. 新增文件

#### `Client/qml/windows/UserDetailWindow.qml`
- 基于 `UserDetailDialog.qml` 创建
- 使用 `ApplicationWindow` 而不是 `Dialog`
- 窗口大小：450x600，最小尺寸：400x500
- 包含用户头像、基本信息、个人简介等显示
- 提供"关闭"和"加为好友"按钮

#### `Client/qml/windows/AddFriendWindow.qml`
- 基于 `AddFriendConfirmDialog.qml` 创建
- 使用 `ApplicationWindow` 而不是 `Dialog`
- 窗口大小：500x600，最小尺寸：450x550
- 包含备注名称、好友分组、验证信息等输入字段
- 提供"取消"和"发送请求"按钮

### 2. 修改文件

#### `Client/qml/pages/MainPage.qml`
- 移除 `UserDetailDialog` 和 `AddFriendConfirmDialog` 组件
- 添加窗口管理逻辑：
  - `createUserDetailWindow()` - 创建用户详情窗口
  - `createAddFriendWindow()` - 创建添加好友窗口
  - `showUserDetail(user)` - 显示用户详情窗口
  - `showAddFriend(user)` - 显示添加好友窗口
- 更新信号连接和事件处理
- 添加窗口清理逻辑

#### `Client/qml/components/UserSearchDialog.qml`
- 移除对话框依赖属性
- 添加新的信号：
  - `viewUserDetail(userInfo)` - 查看用户详情
  - `addFriendRequest(userInfo)` - 添加好友请求
- 更新事件处理逻辑

#### `Client/qml.qrc`
- 添加新的窗口文件到资源列表
- 添加缺失的组件文件

### 3. 功能特性

#### 窗口独立性
- 每个窗口都是独立的 `ApplicationWindow`
- 窗口之间可以独立操作，互不影响
- 支持窗口拖拽、调整大小、最小化等操作
- 可以在不同窗口之间自由切换

#### 用户体验优化
- 窗口具有现代化的UI设计
- 支持主题切换（深色/浅色模式）
- 响应式布局，支持窗口大小调整
- 平滑的动画效果

#### 内存管理
- 窗口创建和销毁由MainPage统一管理
- 组件销毁时自动清理窗口资源
- 避免内存泄漏

## 使用方法

### 显示用户详情窗口
```javascript
// 在MainPage中调用
showUserDetail(userInfo)
```

### 显示添加好友窗口
```javascript
// 在MainPage中调用
showAddFriend(userInfo)
```

### 窗口事件处理
```javascript
// 用户详情窗口添加好友事件
function onUserDetailAddFriendClicked() {
    if (userDetailWindow && userDetailWindow.userInfo) {
        showAddFriend(userDetailWindow.userInfo)
    }
}

// 好友请求确认事件
function onFriendRequestConfirmed(requestData) {
    // 发送好友请求到服务器
    if (ChatNetworkClient) {
        ChatNetworkClient.sendFriendRequest(
            requestData.target_user_identifier,
            requestData.message,
            requestData.remark,
            requestData.group
        )
    }
}
```

## 技术细节

### 窗口创建流程
1. 检查窗口是否已存在
2. 如果存在，先销毁旧窗口
3. 创建新的窗口组件
4. 设置窗口属性和信号连接
5. 显示窗口

### 信号连接
- 窗口关闭时发送 `windowClosed` 信号
- 用户操作时发送相应的业务信号
- MainPage接收信号并处理相应的业务逻辑

### 主题支持
- 窗口自动继承当前主题设置
- 支持动态主题切换
- 所有UI元素都遵循主题规范

## 注意事项

1. **窗口管理**：窗口的创建和销毁由MainPage统一管理，避免重复创建
2. **信号连接**：确保在窗口销毁前断开信号连接，避免内存泄漏
3. **主题一致性**：窗口使用与主界面相同的主题管理器
4. **错误处理**：窗口创建失败时提供适当的错误处理

## 测试建议

1. **功能测试**：验证用户详情显示和添加好友功能
2. **窗口操作**：测试窗口拖拽、调整大小、最小化等操作
3. **多窗口测试**：同时打开多个窗口，验证独立性
4. **主题测试**：验证深色/浅色主题切换
5. **内存测试**：验证窗口关闭后内存正确释放
