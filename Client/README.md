# QKChat 客户端

## 项目简介

QKChat客户端是一个基于Qt6和QML开发的即时通讯应用客户端，目前主要实现了完整的用户认证系统。采用C++后端和QML前端的架构设计，支持跨平台运行。

**当前版本状态**：用户认证系统已完成，社交聊天功能已完成开发。

## 已实现功能

### 🔐 用户认证系统
- **用户注册**：支持用户名、邮箱注册，包含完整的表单验证
- **邮箱验证**：注册时发送验证码到邮箱进行验证
- **用户登录**：支持用户名或邮箱登录
- **密码安全**：使用盐值哈希保护用户密码
- **会话管理**：支持自动登录和记住密码功能
- **网络通信**：与服务器进行安全的TCP通信

### 💬 社交聊天功能
- **好友管理**：添加好友、好友请求处理、好友列表显示
- **实时聊天**：一对一文本消息实时收发
- **在线状态**：显示好友在线状态（在线/离线/忙碌/隐身）
- **消息状态**：消息发送状态指示（已发送/已送达/已读）
- **聊天界面**：现代化的聊天气泡界面设计
- **消息历史**：聊天记录查看和分页加载
- **用户搜索**：支持搜索用户并发送好友请求
- **消息撤回**：支持撤回2分钟内发送的消息
- **离线消息**：自动接收离线期间的消息
- **心跳机制**：30秒心跳间隔保持连接状态

### 🎨 用户界面
- **现代化设计**：基于QML的简洁界面设计
- **主题系统**：支持浅色/深色主题切换
- **自定义组件**：包含按钮、文本框、对话框等自定义UI组件
- **页面切换**：流畅的登录/注册页面切换动画
- **响应式提示**：友好的加载提示和错误消息显示

### 📱 用户体验
- **启动优化**：优化的应用启动流程，避免界面卡顿
- **自动连接**：启动时自动尝试连接服务器
- **设置持久化**：用户设置和登录状态本地存储
- **错误处理**：完善的网络错误和异常处理机制

## 技术架构

### 核心技术栈
- **Qt6**：跨平台应用框架
- **QML**：声明式用户界面语言
- **C++17**：高性能后端逻辑
- **SQLite**：本地数据存储
- **OpenSSL**：加密通信支持

### 项目结构
```
Client/
├── main.cpp                 # 应用程序入口
├── Main.qml                # 主窗口QML文件
├── CMakeLists.txt          # CMake构建配置
├── qml/                    # QML界面文件
│   ├── LoginPage.qml       # 登录页面
│   ├── RegisterPage.qml    # 注册页面
│   ├── pages/              # 页面组件
│   │   └── MainPage.qml    # 主聊天页面（集成好友管理）
│   ├── windows/            # 窗口组件
│   │   ├── LoginWindow.qml # 登录窗口
│   │   └── ChatWindow.qml  # 聊天窗口
│   └── components/         # 通用组件
│       ├── ThemeManager.qml    # 主题管理
│       ├── LoadingDialog.qml   # 加载对话框
│       ├── MessageDialog.qml   # 消息对话框
│       ├── FriendListView.qml  # 好友列表视图
│       ├── FriendListItem.qml  # 好友列表项
│       ├── ChatView.qml        # 聊天界面
│       └── MessageBubble.qml   # 消息气泡
└── src/                    # C++源代码
    ├── auth/               # 认证模块
    │   ├── AuthManager.h/cpp      # 认证管理器
    │   ├── NetworkClient.h/cpp    # 网络客户端
    │   └── SessionManager.h/cpp   # 会话管理
    ├── chat/               # 聊天模块
    │   └── ChatNetworkClient.h/cpp # 聊天网络客户端
    ├── models/             # 数据模型
    │   ├── User.h/cpp             # 用户模型
    │   └── AuthResponse.h/cpp     # 认证响应模型
    ├── utils/              # 工具类
    │   ├── Logger.h/cpp           # 日志系统
    │   ├── Crypto.h/cpp           # 加密工具
    │   └── Validator.h/cpp        # 数据验证
    └── DatabaseManager.h/cpp      # 数据库管理
```

### 核心模块

#### 认证模块 (auth/)
- **AuthManager**：认证流程管理，协调登录、注册等操作
- **NetworkClient**：网络通信客户端，处理与服务器的TCP连接
- **SessionManager**：会话状态管理，处理自动登录和会话过期

#### 聊天模块 (chat/)
- **ChatNetworkClient**：聊天网络客户端，处理聊天相关的网络通信
  - 好友管理API调用（添加、删除、搜索好友）
  - 消息发送和接收处理
  - 在线状态管理和心跳机制
  - 离线消息获取和处理
  - 实时消息推送处理

#### 数据模型 (models/)
- **User**：用户信息模型，包含用户基本信息和状态
- **AuthResponse**：认证响应模型，处理服务器返回的认证结果

#### 工具模块 (utils/)
- **Logger**：日志记录系统，支持不同级别的日志输出
- **Crypto**：加密工具类，提供密码哈希和验证功能
- **Validator**：数据验证工具，验证用户输入的有效性

#### 数据库管理
- **DatabaseManager**：SQLite数据库管理，处理本地数据存储
- 支持用户信息、聊天记录、应用设置等数据管理

## 配置说明

### 服务器连接配置
客户端默认连接到本地服务器（localhost:8080），可在`main.cpp`中修改：

```cpp
authManager->initialize("localhost", 8080, true);
```

### 主题配置
主题设置保存在本地，支持：
- 浅色主题：适合明亮环境
- 深色主题：适合夜间使用
- 自动切换：根据系统设置自动切换

### 日志配置
日志文件保存在应用数据目录：
- Windows: `%APPDATA%/QKChat/Client/logs/`
- macOS: `~/Library/Application Support/QKChat/Client/logs/`
- Linux: `~/.local/share/QKChat/Client/logs/`

## 开发状态

### 已完成功能 ✅
- 用户认证系统（注册、登录、邮箱验证）
- 社交聊天功能（好友管理、实时聊天、在线状态）
- 现代化QML界面设计
- 主题系统（浅色/深色主题）
- 网络通信和会话管理
- 本地数据存储
- 日志系统和错误处理

### 开发中功能 🚧
- 群组聊天界面
- 文件传输界面
- 语音消息支持

### 计划功能 📋
- 语音/视频通话界面
- 消息加密显示
- 移动端适配
- 系统通知集成
- 多语言支持

## 构建和运行

### 环境要求
- Qt 6.5.3 或更高版本
- Qt Creator（推荐）
- C++17 编译器支持
- CMake 3.16 或更高版本

### 构建步骤
1. 使用Qt Creator打开`CMakeLists.txt`
2. 配置Qt Kit（Qt_6_5_3_MinGW_64_bit）
3. 构建项目
4. 确保服务器端已启动
5. 运行客户端应用

### 注意事项
- 首次运行需要连接到服务器进行用户注册
- 聊天功能需要服务器端聊天模块正常运行
- 日志文件会在首次运行时自动创建