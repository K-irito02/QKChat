---
type: "always_apply"
---

# QKChat 项目开发规范

## 环境
- **开发框架**: Qt 6.5.3
- **C++标准**: C++17
- **构建系统**: CMake
- **编译器**: Qt_6_5_3_MinGW_64_bit

## 1. 代码风格规范

### 1.1 命名规范（Qt风格）
- **类名**: 使用PascalCase，如`ChatClient`、`MessageHandler`
- **函数名**: 使用camelCase，如`sendMessage()`、`connectToServer()`
- **变量名**: 使用camelCase，如`messageList`、`connectionStatus`
- **常量**: 使用UPPER_SNAKE_CASE，如`MAX_CONNECTIONS`、`DEFAULT_TIMEOUT`
- **私有成员**: 使用下划线前缀，如`_socket`、`_isConnected`
- **命名空间**: 使用小写字母，如`chat`、`network`

### 1.2 文件组织
- **头文件**: 使用`.h`扩展名，包含类声明和必要的包含
- **源文件**: 使用`.cpp`扩展名，包含实现代码
- **QML文件**: 使用`.qml`扩展名，遵循组件命名规范
- **资源文件**: 使用`.qrc`扩展名，统一管理项目资源

### 1.3 代码格式
- 使用4个空格缩进（不使用Tab）
- 大括号采用K&R风格（左大括号不换行）
- 行长度限制在120字符以内
- 使用空行分隔逻辑块
- 操作符前后添加空格
- 逗号后添加空格

## 2. 架构设计原则

### 2.1 SOLID原则
1. **单一职责原则（SRP）**: 每个类只负责一个功能
2. **开闭原则（OCP）**: 对扩展开放，对修改关闭
3. **里氏替换原则（LSP）**: 子类可以替换父类
4. **接口隔离原则（ISP）**: 客户端不应该依赖它不需要的接口
5. **依赖倒置原则（DIP）**: 依赖抽象而不是具体实现

### 2.2 设计模式应用
- 优先使用组合而非继承
- 使用接口定义契约
- 采用依赖注入管理依赖关系
- 使用观察者模式处理事件
- 使用工厂模式创建对象

### 2.3 模块化设计
- 按功能划分模块
- 模块间通过接口通信
- 避免循环依赖
- 使用插件架构扩展功能

## 3. 头文件管理

### 3.1 包含顺序
1. 当前类的头文件
2. C++标准库头文件
3. Qt头文件
4. 第三方库头文件
5. 项目内部头文件

### 3.2 前置声明
- 优先使用前置声明减少编译依赖
- 在头文件中避免不必要的包含

```cpp
// 前置声明
class QTcpSocket;
class QTimer;

// 包含必要的头文件
#include <QObject>
#include <QString>
```

### 3.3 PIMPL模式
对于复杂的类，使用PIMPL（Pointer to Implementation）模式隐藏实现细节

```cpp
// 头文件
class ChatClientPrivate;
class ChatClient : public QObject
{
    Q_OBJECT
public:
    ChatClient();
    ~ChatClient();
    
private:
    ChatClientPrivate *d_ptr;
    Q_DECLARE_PRIVATE(ChatClient)
};
```

## 4. 文档规范

### 4.1 代码注释
- 使用专业级注释规范
- 为所有公共接口添加文档注释
- 解释复杂的业务逻辑

```cpp
/**
 * @brief 发送消息到服务器
 * @param message 要发送的消息内容
 * @param receiver 接收者ID，为空时发送给所有在线用户
 * @return 发送是否成功
 * @note 此函数是异步的，实际发送状态通过信号通知
 */
bool sendMessage(const QString &message, const QString &receiver = QString());
```

### 4.2 类文档
```cpp
/**
 * @brief 聊天客户端类
 * 
 * 负责与聊天服务器的通信，包括连接管理、消息发送接收等功能。
 * 使用Qt的网络模块实现TCP连接，支持TLS加密通信。
 * 
 * @example
 * @code
 * ChatClient client;
 * connect(&client, &ChatClient::messageReceived, 
 *         this, &MainWindow::handleMessage);
 * client.connectToServer("localhost", 8080);
 * @endcode
 */
class ChatClient : public QObject
{
    // ...
};
```

## 5. 错误处理规范

### 5.1 异常处理
- 优先使用返回值而非异常
- 使用Qt的错误处理机制
- 提供有意义的错误信息

### 5.2 日志记录
- 记录关键操作和错误信息
- 使用适当的日志级别

#### 5.2.1记录要求
- **日志文件**: 每个功能模块创建一个文件
- **日志格式**: `yyyy-MM-dd hh:mm:ss.zzz`

```
[时间戳][日志级别]: [消息内容]
[堆栈追踪信息]

// 示例
[2025-08-05 02:10:11.365] ERROR: Connection failed to client 192.168.1.100
Stack trace:
  at ChatServer::handleConnection (chatserver.cpp:245)
  at QObject::event (qobject.cpp:123)
  at QApplication::processEvents (qapplication.cpp:456)
```

#### 5.2.2清理要求
- 每次重新运行项目前，会自动清空日志

#### 5.2.3日志路径
- **客户端日志**: `D:\QT_Learn\Projects\QKChat\Client\logs`
- **服务器端日志**: `D:\QT_Learn\Projects\QKChat\Server\logs`

## 6. 性能优化规范

### 6.1 内存管理
- 使用智能指针管理资源
- 避免内存泄漏
- 合理使用Qt的对象树机制